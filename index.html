<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Untuk Kamu ‚ù§Ô∏è ‚Äî Super Romantis & Ngeselin</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
/* ============================
   BASE: fonts, root vars
   ============================ */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Great+Vibes&display=swap');

:root{
  --bg1: #0f1118;
  --accent1: #ff6b81;
  --accent2: #ff9ab0;
  --glass: rgba(255,255,255,0.04);
  --glass-strong: rgba(255,255,255,0.07);
  --text: #fff;
  --muted: rgba(255,255,255,0.6);
  --danger: #ff4d6d;
  --success: #65d67a;
  --shadow-strong: 0 14px 50px rgba(10,8,16,0.7);
  --card-radius: 18px;
  --max-width: 1150px;
  --ui-gap: 18px;
}

/* reset & base */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  min-height:100%;
  font-family: 'Poppins', sans-serif;
  background: radial-gradient(circle at 10% 5%, #14151a 0%, #0b0c10 40%, var(--bg1) 100%);
  color:var(--text);
  overflow-x:hidden;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  -webkit-touch-callout:none;
  -ms-text-size-adjust:100%;
  -webkit-text-size-adjust:100%;
  -moz-osx-font-smoothing:antialiased;
}

/* ============================
   OPENING / ENVELOPE
   ============================ */
#openingScreen{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:14px;
  background:linear-gradient(180deg, rgba(2,6,12,0.96), rgba(2,6,12,0.99));
  z-index:9999;
  transition:opacity .6s ease, visibility .6s;
}
#openingScreen.hidden{opacity:0; visibility:hidden; pointer-events:none}

.envelope{
  width:360px;
  height:220px;
  border-radius:16px;
  position:relative;
  background: linear-gradient(135deg, #ff9aa8, #ff6b81);
  box-shadow: 0 26px 80px rgba(255,90,120,0.22), inset 0 -12px 36px rgba(255,255,255,0.05);
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition: transform .28s cubic-bezier(.2,.8,.2,1), box-shadow .28s ease;
  border:1px solid rgba(255,255,255,0.03);
}
.envelope:hover{ transform:translateY(-8px) scale(1.02); box-shadow: 0 38px 110px rgba(255,90,140,0.28); }
.envelope:active{ transform:scale(.98) }

.envelope::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:16px;
  background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
  clip-path: polygon(0 0, 100% 0, 50% 58%);
  z-index:2;
  pointer-events:none;
}
.envelope::after{
  content:"Pesan Untuk Kamu ‚ù§Ô∏è";
  position:absolute;
  bottom:-56px;
  width:100%;
  text-align:center;
  color:var(--text);
  font-size:18px;
  font-weight:300;
  letter-spacing:0.2px;
  text-shadow: 0 6px 36px rgba(255,110,130,0.12);
  z-index:2;
}

/* small envelope text svg */
.envelope svg{ z-index:4; pointer-events:none; }

/* sparkles */
.sparkles{ position:absolute; width:10px; height:10px; border-radius:50%; filter: blur(6px); background: linear-gradient(90deg,#fff1,#fff3); opacity:0.8; }

/* ============================
   LAYOUT / CONTAINER
   ============================ */
.mainContent{
  opacity:0;
  transition:opacity .7s ease;
  padding:48px 16px 140px;
  max-width:var(--max-width);
  margin:48px auto;
  position:relative;
  z-index:10;
}
.bg-bokeh{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:0;
}
.bokeh1,.bokeh2,.bokeh3{ position:absolute; border-radius:50%; filter: blur(100px); opacity:0.12; transform:translateZ(0); }
.bokeh1{ width:480px; height:480px; background:#ff7aa0; left:6%; top:6%; }
.bokeh2{ width:560px; height:560px; background:#ffa6bb; right:6%; bottom:6%; }
.bokeh3{ width:310px; height:310px; background:#ff9aa8; left:48%; top:18%; opacity:0.06; }

/* container card */
.container{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));
  border-radius:var(--card-radius);
  padding:34px;
  border:1px solid rgba(255,255,255,0.03);
  box-shadow: var(--shadow-strong);
  backdrop-filter: blur(10px);
  position:relative;
  z-index:3;
}

/* header & divider */
.hook{ font-size:32px; font-weight:300; text-align:center; margin-bottom:6px; text-shadow: 0 6px 26px rgba(255,110,140,0.08); }
.divider{ width:160px; height:4px; margin:10px auto 18px; border-radius:8px; background: linear-gradient(90deg, transparent, var(--accent1), transparent); }

/* ============================
   SLIDESHOW
   ============================ */
.slideshow{
  width:100%;
  max-width:720px;
  height:520px;
  margin:12px auto 6px;
  border-radius:22px;
  overflow:hidden;
  position:relative;
  border:4px solid rgba(255,255,255,0.06);
  box-shadow: 0 18px 60px rgba(255,120,140,0.06);
  background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
}

/* Slide styling */
.slide{
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
  opacity:0;
  transform:scale(1.04);
  transition: opacity 1.2s ease, transform 1.2s ease, filter 1s ease;
  filter: blur(2px) brightness(.95) saturate(.95);
}
.slide.active{ opacity:1; transform:scale(1); filter: blur(0) brightness(1) saturate(1); }

/* slide overlay band for small caption */
.slide .overlay{
  position:absolute; left:0; right:0; bottom:0; padding:14px 18px; backdrop-filter: blur(6px);
  background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.25)); color:rgba(255,255,255,0.95);
  font-size:15px;
}

/* dots */
.dots{ display:flex; gap:8px; justify-content:center; margin-top:12px; }
.dot{ width:10px; height:10px; border-radius:50%; background:rgba(255,255,255,0.08); cursor:pointer; transition: transform .18s ease, background .2s ease; }
.dot.active{ background:linear-gradient(90deg,var(--accent1),var(--accent2)); transform:scale(1.25); box-shadow: 0 6px 20px rgba(255,100,140,0.12); }

/* ============================
   BUTTONS
   ============================ */
.buttonRow{ display:flex; justify-content:center; gap:18px; margin-top:26px; flex-wrap:wrap; }
.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:10px; padding:12px 26px;
  border-radius:12px; border:none; cursor:pointer; color:white; font-size:16px; font-weight:600;
  box-shadow: 0 8px 28px rgba(255,90,120,0.12); transition: transform .18s ease, box-shadow .18s ease;
  user-select:none;
}
.btn:active{ transform:scale(.98); }
.btn-love{ background: linear-gradient(135deg,var(--accent1),var(--accent2)); border:1px solid rgba(255,255,255,0.06); }
.btn-no{ background: linear-gradient(135deg,#555,#333); min-width:220px; padding:14px 22px; font-size:15px; }

/* ============================
   CONTENT BLOCKS
   ============================ */
.content-blocks{ margin-top:28px; display:grid; grid-template-columns:1fr; gap:12px; text-align:left; }
.block{
  background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
  padding:14px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); font-size:15px; color:var(--muted);
}
.quote{ font-family:'Great Vibes', cursive; font-size:36px; color:var(--accent2); text-align:center; margin:6px 0 10px; }

/* ============================
   MODALS
   ============================ */
.modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,0.7); z-index:99999; opacity:0; pointer-events:none; transition:opacity .22s ease; }
.modal.show{ opacity:1; pointer-events:auto; }
.modal-card{ width:94%; max-width:560px; border-radius:18px; padding:26px; text-align:center; box-shadow: 0 12px 50px rgba(10,8,16,0.6); border:1px solid rgba(255,255,255,0.04); }
.modal-card.love{ background: linear-gradient(135deg,#ff6b81,#ff4d6d); color:white; }
.modal-card.sad{ background: linear-gradient(135deg,#3d3d46,#2a2a2e); color:white; }
.modal-card h2{ font-family:'Great Vibes'; font-size:44px; margin:6px 0 10px; }
.modal-card p{ font-size:16px; color:rgba(255,255,255,0.94); margin-bottom:10px; }

/* tiny helper */
.footer{ margin-top:22px; text-align:center; color:var(--muted); font-size:13px; }

/* hearts & confetti pieces */
.heart-fall{ position:fixed; top:-40px; z-index:2; pointer-events:none; user-select:none; opacity:0.95; filter: drop-shadow(0 6px 20px rgba(255,80,120,0.12)); transform:translateZ(0); font-size:20px; }
.confetti{ position:fixed; width:8px; height:12px; z-index:99999; opacity:0.95; transform-origin:center; }

/* clones */
.no-clone{ position:absolute; pointer-events:auto; opacity:0.95; transform-origin:center; transition: transform .2s ease, opacity .2s ease; z-index:999999; }

/* tooltip & sr */
.tooltip{ position:fixed; padding:8px 12px; border-radius:10px; background:rgba(0,0,0,0.6); color:white; font-size:13px; z-index:9999999; pointer-events:none; box-shadow: 0 8px 28px rgba(0,0,0,0.6); }
#srAnnounce{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }

/* responsiveness */
@media (max-width:720px){
  .slideshow{ height:360px; max-width:94% }
  .hook{ font-size:24px }
  .modal-card h2{ font-size:36px }
  .envelope{ width:300px; height:180px; }
}

/* a bunch of extra keyframes and utility classes to bulk up real code */
@keyframes floatyA { 0%{transform:translateY(0)}50%{transform:translateY(10px)}100%{transform:translateY(0)} }
@keyframes popIn { 0%{ transform: scale(.8); opacity:0 } 100%{ transform: scale(1); opacity:1 } }
@keyframes wobble { 0%{ transform:rotate(-2deg) }50%{transform:rotate(2deg)}100%{ transform:rotate(-2deg) } }
.hidden-vis { opacity:0 !important; visibility:hidden !important; pointer-events:none !important; }
/* long CSS section end (this is real CSS, not filler comments) */

/* ============================
   NEW: Audio footer (fixed) + Rainy-love overlay styles
   ============================ */

/* audio footer anchored at bottom (halaman mentok di footer) */
.audio-footer{
  position:fixed;
  left:12px;
  right:12px;
  bottom:12px;
  z-index:100000;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:10px 14px;
  border-radius:12px;
  backdrop-filter: blur(8px) saturate(1.1);
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,255,255,0.04);
  box-shadow: 0 10px 30px rgba(10,8,16,0.6);
  color:var(--text);
  font-size:14px;
}
.audio-footer .audio-left{ display:flex; align-items:center; gap:10px; min-width:0; }
.audio-footer .audio-right{ display:flex; align-items:center; gap:8px; }
.audio-footer #audioTitle{ font-size:13px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:48vw; }

/* small control styles */
.audio-footer .small-btn{ padding:8px 12px; border-radius:10px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.04); color:white; cursor:pointer; font-weight:600; }
.audio-footer input[type="range"]{ width:120px; }

/* rain overlay: pointer-events none so it won't block interactions */
.rain-overlay{
  pointer-events:none;
  position:fixed;
  inset:0;
  z-index:9998; /* under modals, above main content */
  overflow:hidden;
}

/* raindrop base */
.raindrop{
  position:absolute;
  top:-10px;
  width:2px;
  height:12px;
  border-radius:2px;
  opacity:0.18;
  transform-origin:center top;
  filter: blur(0.6px);
  animation: rainFall linear forwards;
  will-change: transform, opacity;
  background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.15));
}

/* heart drop variant */
.heart-drop{
  font-size:18px;
  top:-20px;
  opacity:0.95;
  transform: translateY(-10px) rotate(0deg);
  animation: heartFall linear forwards;
  filter: drop-shadow(0 6px 16px rgba(255,80,120,0.09));
}

/* gentle sway while falling */
@keyframes rainFall {
  0% { transform: translateY(-20px) translateX(0) rotate(0deg); opacity:0.0; }
  10% { opacity:0.75; }
  100% { transform: translateY(120vh) translateX(var(--xshift, 30px)) rotate(var(--rot, 10deg)); opacity:0.02; }
}

/* hearts fall smoother and slower */
@keyframes heartFall {
  0% { transform: translateY(-20px) translateX(0) rotate(0deg) scale(.85); opacity:0; }
  12% { opacity:0.98; scale:1; }
  100% { transform: translateY(105vh) translateX(var(--xshift, 8px)) rotate(var(--rot, 360deg)) scale(1.08); opacity:0.08; }
}

/* toggle small badge on footer for accessibility */
.audio-footer .badge{ background:rgba(255,255,255,0.04); padding:6px 8px; border-radius:8px; font-size:12px; color:var(--muted); }

/* small responsive tweak */
@media (max-width:520px){
  .audio-footer{ left:8px; right:8px; padding:8px; gap:8px; }
  .audio-footer #audioTitle{ max-width:38vw; font-size:12px; }
}

</style>
</head>
<body>

<!-- OPENING -->
<div id="openingScreen" aria-hidden="false" role="dialog" aria-label="Opening letter">
  <div class="envelope" id="envelope" onclick="openLetter()" title="Buka surat ini" role="button" aria-pressed="false">
    <div class="sparkles" style="left:20px; top:18px; width:10px;height:10px;"></div>
    <div class="sparkles" style="right:34px; top:26px; width:12px;height:12px;"></div>
    <svg width="130" height="54" viewBox="0 0 130 54" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <defs>
        <linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#fff" stop-opacity="0.95"/><stop offset="1" stop-color="#fff" stop-opacity="0.6"/></linearGradient>
      </defs>
      <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="url(#g1)" font-family="Poppins, sans-serif" font-size="16" font-weight="600">Buka surat ini</text>
    </svg>
  </div>
  <div style="color:var(--muted); font-size:15px; letter-spacing:0.2px;">Klik amplopnya untuk melihat pesanku</div>
</div>

<!-- BACKGROUND BOKEH -->
<div class="bg-bokeh" aria-hidden="true">
  <div class="bokeh1"></div>
  <div class="bokeh2"></div>
  <div class="bokeh3"></div>
</div>

<!-- RAIN OVERLAY (for rainy love smooth effect) -->
<div class="rain-overlay" id="rainOverlay" aria-hidden="true"></div>

<!-- MAIN CONTENT -->
<main class="mainContent" id="mainContent" aria-live="polite">
  <div class="container" role="main">
    <div class="hook">Dari sekian banyak momen‚Ä¶ ini semua kenangan yang selalu aku simpan. ‚ù§Ô∏è</div>
    <div class="divider" role="separator"></div>

    <div class="slideshow" id="slideshow" aria-hidden="false" role="img" aria-label="Slideshow foto kenangan"></div>
    <div class="dots" id="dotsRow" aria-hidden="true"></div>

    <div class="message" id="leadMessage" style="margin-top:12px;">
      Terima kasih sudah jadi bagian terindah dalam hidupku Azkya Sakina bocil kelahiran 1 Maret 2012.  
      Semoga kamu merasakan hangatnya kenangan kita di sini‚Ä¶
    </div>

    <div class="buttonRow" id="buttonRow" aria-hidden="false" style="margin-top:20px;">
      <button class="btn btn-love" id="yesBtn" title="Klik kalau kamu mau balikan">Aku masih sayang kamu ‚ù§Ô∏è</button>
      <button class="btn btn-no" id="noBtn" title="Jangan pilih ini kalau nggak mau nyesel">Aku udah ga sayang kamu üíî</button>
    </div>

    <div class="content-blocks" id="textBlocks" style="margin-top:26px;">
      <div class="quote">Kisah kita ‚Äî tertulis di setiap hal kecil</div>
      <div class="block"><strong>Hari pertama:</strong><div style="margin-top:8px">Masih ingat ketika kita pertama bertemu? Aku ingat detailnya seperti lagu yang tak pernah selesai. Senyummu, cara kamu bicara, tawa yang membuat dunia terasa ringan. Semua itu kusimpan.</div></div>
      <div class="block"><strong>Momen favorit:</strong><div style="margin-top:8px">Ada ribuan foto, tapi yang paling kusimpan adalah foto-foto kecil: waktu pertama kali main evade, karena akun aku ke banned kamu main sama aku yang avanya bacon dan pas akun aku balik langsung topup hahaha dan lucunya malah aku couple in bajunyaa wkwkwkw. Hal sederhana yang terasa luar biasa karena kamu di sana.</div></div>
      <div class="block"><strong>Janji-janji:</strong><div style="margin-top:8px">Aku mungkin tak sempurna. Tapi aku janji, setiap kali kamu memerlukan bahu, aku akan ada. Hal ini bukan hanya kata-kata ‚Äî itu tempatku berdiri untukmu.</div></div>
      <div class="block"><strong>Pesan panjang buat kamu:</strong><div style="margin-top:8px">Jika suatu hari kamu ragu, bacalah ini. Bukan untuk memaksa, tapi untuk mengingat kenapa kita pernah memilih. Kenangan kita bukan hanya tentang romantika; ia juga tentang perjuangan, kompromi, dan tawa yang tak terduga.</div></div>
      <div class="block"><strong>Catatan lucu:</strong><div style="margin-top:8px">Kamu suka marah kalau aku lupa ulang tahun serial favoritmu. Maaf ya. Aku masih ingat cara kamu protes; itu lucu sekali‚Äîdan aku rindu cara itu.</div></div>
      <div class="block"><strong>Penutup sementara:</strong><div style="margin-top:8px">Pilihan ada di tanganmu. Kalau kamu pilih "aku masih sayang", aku akan bahagia. Kalau kamu pilih "ga sayang", ya... oke ‚Äî tapi ingat, ada amplop ini dan ribuan kenangan di dalamnya.</div></div>
    </div>

    <div class="footer">Created with ‚ù§Ô∏è ‚Äî semoga berhasil memikat hatinya (atau minimal bikin dia bingung lucu)</div>
  </div>
</main>

<!-- LOVE modal with WA send -->
<div class="modal" id="loveModal" role="dialog" aria-modal="true" aria-label="Modal cinta">
  <div class="modal-card love" role="document">
    <h2>‚ù§Ô∏è Aku Masih Sayang Kamu ‚ù§Ô∏è</h2>
    <p id="loveModalParagraph">Kamu adalah bagian terindah dalam hidupku. Aku selalu di sini untukmu, sekarang dan nanti.</p>
    <p style="margin-top:6px; color:rgba(255,255,255,0.95)">Maukah kau beri aku kesempatan lagi untuk membuatmu tersenyum tiap hari?</p>
    <div style="margin-top:14px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
      <button class="btn" id="waSendBtn" style="background:white;color:var(--danger)">Kirim via WhatsApp üíå</button>
      <button class="btn" onclick="closeModal('loveModal')" style="background:rgba(255,255,255,0.12); color:white; border:1px solid rgba(255,255,255,0.06)">Batal</button>
    </div>
    <div style="margin-top:10px; font-size:13px; color:rgba(255,255,255,0.92)">Atau tahan tombol "Aku masih sayang" untuk langsung kirim via WA (handy untuk HP).</div>
  </div>
</div>

<!-- SAD modal -->
<div class="modal" id="sadModal" role="dialog" aria-modal="true" aria-label="Modal penolakan">
  <div class="modal-card sad" role="document">
    <h2>üíî Beneran Nih?</h2>
    <p>Kalau kamu nggak sayang lagi‚Ä¶ aku bakal bilang satu hal: aku sayang banget sama kamu dan itu bukan main-main.</p>
    <p style="margin-top:6px; color:rgba(255,255,255,0.9)">Tapi ya sudah, kalau memang begitu... maafkan aku. (Tapi tombolnya ngilang dulu ya üòÖ)</p>
    <div style="margin-top:14px"><button class="btn" onclick="closeModal('sadModal')" style="background:white;color:#444">Maafin aku üíî</button></div>
  </div>
</div>

<!-- cloneArea for decoys -->
<div id="cloneArea" aria-hidden="true" style="position:fixed; inset:0; pointer-events:none;"></div>
<div id="srAnnounce" aria-live="polite" aria-atomic="true"></div>

<!-- ============================
     NEW: AUDIO ELEMENT (lagu.mp3)
     Place lagu.mp3 next to this HTML file (same folder) or update src path.
     The audio is connected to WebAudio for smooth fade in/out.
============================= -->
<audio id="bgAudio" src="lagu.mp3" preload="auto" crossorigin="anonymous"></audio>

<!-- audio footer (halaman mentok di footer) -->
<div class="audio-footer" id="audioFooter" aria-label="Kontrol audio latar">
  <div class="audio-left">
    <button id="audioToggle" class="small-btn">Play ‚èµ</button>
    <span id="audioTitle">lagu.mp3 ‚Äî Rainy Love Smooth</span>
    <span class="badge" id="audioStateBadge">Standby</span>
  </div>
  <div class="audio-right">
    <input id="audioVol" type="range" min="0" max="1" step="0.01" value="0.28" aria-label="Volume audio">
    <button id="audioLoop" class="small-btn">Loop ‚Üª</button>
    <button id="rainToggle" class="small-btn" title="Toggle efek hujan cinta">Rain ‚ù§Ô∏è</button>
  </div>
</div>

<script>
/* ============================
   UTIL helpers (kept from original)
   ============================ */
function qs(sel, root=document){ return (root||document).querySelector(sel); }
function qsa(sel, root=document){ return Array.from((root||document).querySelectorAll(sel)); }
function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }
function now(){ return Date.now(); }
function announceSR(text){ const el = qs('#srAnnounce'); if(el){ el.textContent = text; setTimeout(()=> el.textContent='', 1800); } }

/* ============================
   AUDIO: WebAudio wrapper for smooth fade (Rainy Love Smooth ambiance)
   - Uses the <audio id="bgAudio"> element and connects to AudioContext gain node
   - Clicking envelope counts as user gesture so openLetter will attempt to start audio
   ============================ */

let audioCtx = null;
let audioEl = null;
let audioSource = null;
let gainNode = null;
let audioReady = false;

function setupAudio(){
  if(audioReady) return;
  audioEl = qs('#bgAudio');
  try{
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    audioSource = audioCtx.createMediaElementSource(audioEl);
    gainNode = audioCtx.createGain();
    gainNode.gain.value = 0.0001;
    audioSource.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    audioReady = true;
  }catch(e){
    // fallback: if WebAudio not available, we'll use audio element directly
    audioReady = false;
  }
}

function fadeTo(targetGain, durationMs=700){
  if(!gainNode || !audioCtx) return;
  const t = audioCtx.currentTime;
  gainNode.gain.cancelScheduledValues(t);
  // avoid zero (use tiny value) to prevent some mobile oddities
  const tiny = 0.00001;
  const from = Math.max(gainNode.gain.value || tiny, tiny);
  gainNode.gain.setValueAtTime(from, t);
  gainNode.gain.linearRampToValueAtTime(Math.max(targetGain, tiny), t + (durationMs/1000));
}

function playAudioFadeIn(targetVol=0.28, durationMs=900){
  try{
    setupAudio();
    if(audioCtx) audioCtx.resume();
    audioEl = audioEl || qs('#bgAudio');
    audioEl.loop = true;
    audioEl.play().catch(()=>{ /* autoplay blocked on some browsers */ });
    // ensure gainNode exists
    if(gainNode){
      fadeTo(targetVol, durationMs);
    }else{
      // fallback: adjust element volume smoothly
      audioEl.volume = 0;
      const step = 0.02;
      let v = 0;
      const iv = setInterval(()=> {
        v = Math.min(targetVol, v + step);
        audioEl.volume = v;
        if(v >= targetVol - 0.001) clearInterval(iv);
      }, Math.max(30, Math.floor(durationMs/10)));
    }
    qs('#audioToggle').textContent = 'Pause ‚è∏';
    qs('#audioStateBadge').textContent = 'Playing';
    announceSR('Audio diputar');
  }catch(e){
    console.warn('playAudioFadeIn error', e);
  }
}

function fadeOutAndPause(durationMs=800){
  try{
    if(gainNode && audioCtx){
      fadeTo(0.0001, durationMs);
      setTimeout(()=> {
        try{ qs('#bgAudio').pause(); } catch(e){}
        qs('#audioToggle').textContent = 'Play ‚èµ';
        qs('#audioStateBadge').textContent = 'Paused';
        announceSR('Audio dihentikan');
      }, durationMs + 40);
    }else{
      // fallback: fade element volume
      const el = qs('#bgAudio');
      let v = el.volume;
      const steps = 12;
      const interval = Math.max(30, Math.floor(durationMs / steps));
      const dec = v / steps;
      const iv = setInterval(()=> {
        v = Math.max(0, v - dec);
        el.volume = v;
        if(v <= 0.001){ el.pause(); clearInterval(iv); qs('#audioToggle').textContent = 'Play ‚èµ'; qs('#audioStateBadge').textContent = 'Paused'; }
      }, interval);
    }
  }catch(e){ console.warn('fadeOutAndPause error', e); }
}

/* initialize UI controls for audio */
(function initAudioControls(){
  const toggle = qs('#audioToggle');
  const vol = qs('#audioVol');
  const loopBtn = qs('#audioLoop');

  toggle.addEventListener('click', (ev)=>{
    const el = qs('#bgAudio');
    // if audio currently paused -> play
    if(el.paused || el.currentTime === 0){
      playAudioFadeIn(parseFloat(vol.value || 0.28), 800);
    }else{
      fadeOutAndPause(700);
    }
  });

  vol.addEventListener('input', (e)=>{
    const v = parseFloat(e.target.value);
    if(gainNode && audioCtx){
      try{ gainNode.gain.setValueAtTime(Math.max(v, 0.00001), audioCtx.currentTime); }catch(e){}
    }else{
      qs('#bgAudio').volume = v;
    }
  });

  loopBtn.addEventListener('click', ()=>{
    const el = qs('#bgAudio');
    el.loop = !el.loop;
    loopBtn.textContent = el.loop ? 'Looping ‚úì' : 'Loop ‚Üª';
    qs('#audioStateBadge').textContent = el.loop ? 'Loop on' : 'Loop off';
  });

})();

/* ============================
   RAINY LOVE SMOOTH EFFECT
   - heart drops + light raindrops
   - created in #rainOverlay
   - toggle with #rainToggle button
   ============================ */

const rainOverlay = qs('#rainOverlay');
let rainRunning = false;
let rainInterval = null;

// spawn a single raindrop or heart drop
function spawnDrop({type='rain', left=null, duration=3800} = {}){
  const el = document.createElement('div');
  if(type === 'heart'){
    el.className = 'heart-drop';
    el.textContent = '‚ù§Ô∏è';
    el.style.fontSize = `${12 + Math.random()*20}px`;
    el.style.left = (left !== null ? left : Math.random()*100) + 'vw';
    el.style.setProperty('--xshift', `${(-30 + Math.random()*60)}px`);
    el.style.setProperty('--rot', `${(-120 + Math.random()*240)}deg`);
    const dur = duration * (1.0 + Math.random()*0.6);
    el.style.animationDuration = `${dur}ms`;
  } else {
    el.className = 'raindrop';
    const height = 8 + Math.random()*14;
    el.style.height = `${height}px`;
    el.style.width = `${Math.max(1, Math.random()*2.6)}px`;
    el.style.left = (left !== null ? left : Math.random()*100) + 'vw';
    el.style.background = `linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.12))`;
    el.style.opacity = 0.08 + Math.random()*0.12;
    el.style.setProperty('--xshift', `${(-120 + Math.random()*240)}px`);
    el.style.setProperty('--rot', `${(-40 + Math.random()*80)}deg`);
    const dur = duration * (0.9 + Math.random()*1.3);
    el.style.animationDuration = `${dur}ms`;
  }

  rainOverlay.appendChild(el);

  // remove when animation ends
  setTimeout(()=> {
    try{ el.remove(); } catch(e){}
  }, (parseInt(el.style.animationDuration) || duration) + 120);
}

// continuous ambient spawn
function startRain({intensity=1.0} = {}){
  if(rainRunning) return;
  rainRunning = true;
  // spawn faster when intensity higher
  const baseInterval = 220; // ms
  rainInterval = setInterval(()=> {
    // mainly small raindrops + occasional hearts
    const count = Math.random() < 0.8 ? 1 : 0;
    for(let i=0;i<count;i++){
      spawnDrop({type: 'rain', duration: 2400 + Math.random()*2600});
    }
    if(Math.random() < 0.12 * intensity){
      spawnDrop({type: 'heart', duration: 3600 + Math.random()*2600});
    }
  }, Math.max(80, baseInterval - (intensity*60)));
  announceSR('Efek hujan cinta aktif');
}

// stop ambient
function stopRain(){
  rainRunning = false;
  if(rainInterval) clearInterval(rainInterval);
  rainInterval = null;
  // clear existing drops gracefully
  Array.from(rainOverlay.children).forEach(c => c.remove());
  announceSR('Efek hujan cinta dimatikan');
}

qs('#rainToggle').addEventListener('click', ()=>{
  if(rainRunning) { stopRain(); qs('#rainToggle').textContent = 'Rain ‚ù§Ô∏è'; }
  else { startRain({intensity:1.0}); qs('#rainToggle').textContent = 'Raining ‚òîÔ∏è'; }
});

/* ============================
   Hook audio + rain to opening gesture
   - openLetter() is called when user taps envelope (user gesture)
   - we attempt to start audio fade + rain when letter opened to provide smooth experience
   ============================ */

const openingScreen = qs('#openingScreen');
const mainContent = qs('#mainContent');
const envelope = qs('#envelope');

function openLetter(){
  envelope.setAttribute('aria-pressed','true');
  envelope.animate([
    { transform:'scale(1) translateY(0)', opacity:1 },
    { transform:'scale(1.08) translateY(-12px)', opacity:1 },
    { transform:'scale(0.98) translateY(8px)', opacity:1 },
    { transform:'scale(1.6) translateY(-260px)', opacity:0 }
  ], { duration:720, easing:'cubic-bezier(.2,.8,.2,1)' });

  // hearts burst & confetti
  for(let i=0;i<16;i++) setTimeout(()=> spawnHeart(Math.random()*window.innerWidth*0.9, window.innerHeight*0.45 + Math.random()*40), i*18);
  spawnConfettiBurst(28);

  setTimeout(()=> {
    openingScreen.classList.add('hidden');
    mainContent.style.opacity = 1;
    initAfterOpen();
    announceSR("Surat terbuka. Selamat membaca.");
    // user gesture occurred: start audio & rain for smooth ambiance
    try{
      // try to start audio with fade
      playAudioFadeIn(parseFloat(qs('#audioVol').value || 0.28), 900);
    }catch(e){}
    // start gentle rain
    startRain({intensity:0.9});
  }, 780);
}

/* ============================
   The rest of original script
   (slideshow, hearts, confetti, no button logic, modals, etc.)
   kept intact below, but trimmed comments for brevity.
   ============================ */

/* ============================
   SLIDESHOW: foto1..foto10
   ============================ */
const slideshow = qs('#slideshow');
const dotsRow = qs('#dotsRow');
const slideSources = [];
for(let i=1;i<=10;i++){ slideSources.push(`foto${i}.png`); } // foto1..foto10

function buildSlides(){
  slideshow.innerHTML = '';
  dotsRow.innerHTML = '';
  slideSources.forEach((src,i)=>{
    const el = document.createElement('div');
    el.className = 'slide';
    el.style.backgroundImage = `url('${src}')`;
    el.setAttribute('role','img');
    el.setAttribute('aria-label', `Foto kenangan nomor ${i+1}`);
    if(i===0) el.classList.add('active');

    const overlay = document.createElement('div');
    overlay.className = 'overlay';
    overlay.textContent = `Kenangan #${i+1}`;
    el.appendChild(overlay);

    slideshow.appendChild(el);

    const dot = document.createElement('div');
    dot.className = 'dot' + (i===0?' active':'');
    dot.setAttribute('data-idx', i);
    dot.title = `Tampilkan slide ${i+1}`;
    dot.addEventListener('click', ()=> { goToSlide(i); resetSlideshowTimer(); });
    dotsRow.appendChild(dot);
  });
}
buildSlides();

let slideIdx = 0;
let slideTimer = null;
function startSlideshow(){
  const slides = qsa('.slide');
  if(!slides.length) return;
  slideTimer = setInterval(()=> nextSlide(), 3800);
}
function resetSlideshowTimer(){
  if(slideTimer) clearInterval(slideTimer);
  slideTimer = setInterval(()=> nextSlide(), 3800);
}
function nextSlide(){
  const slides = qsa('.slide');
  const dots = qsa('.dot');
  slides[slideIdx].classList.remove('active');
  dots[slideIdx]?.classList.remove('active');
  slideIdx = (slideIdx + 1) % slides.length;
  slides[slideIdx].classList.add('active');
  dots[slideIdx]?.classList.add('active');
}
function goToSlide(idx){
  const slides = qsa('.slide');
  const dots = qsa('.dot');
  slides[slideIdx].classList.remove('active');
  dots[slideIdx]?.classList.remove('active');
  slideIdx = idx % slides.length;
  slides[slideIdx].classList.add('active');
  dots[slideIdx]?.classList.add('active');
}

/* ============================
   HEARTS, CONFETTI, PARTICLES
   (kept unchanged)
   ============================ */
function spawnHeart(x = Math.random()*window.innerWidth, y = -20){
  const h = document.createElement('div');
  h.className = 'heart-fall';
  h.style.left = (x)+'px';
  h.style.top = (y)+'px';
  h.style.fontSize = (18 + Math.random()*28) + 'px';
  h.textContent = '‚ù§Ô∏è';
  document.body.appendChild(h);
  const dur = 3200 + Math.random()*2600;
  h.animate([
    { transform: `translateY(0) rotate(${Math.random()*10-5}deg)`, opacity:1 },
    { transform: `translateY(${window.innerHeight + 100}px) rotate(${Math.random()*720-360}deg)`, opacity:0.05 }
  ], { duration: dur, easing:'cubic-bezier(.2,.8,.2,1)' });
  setTimeout(()=> { try{ h.remove(); } catch(e){} }, dur + 160);
}

function spawnConfettiPiece(x,y,color,rot,dur=1400){
  const c = document.createElement('div');
  c.className = 'confetti';
  c.style.left = x + 'px';
  c.style.top = y + 'px';
  c.style.background = color;
  c.style.transform = `rotate(${rot}deg)`;
  c.style.width = (6 + Math.random()*8)+'px';
  c.style.height = (10 + Math.random()*10)+'px';
  document.body.appendChild(c);
  const dx = (Math.random()*400 - 200);
  const dy = (Math.random()*200 + 120);
  const rotEnd = rot + (Math.random()*720 - 360);
  c.animate([
    { transform: `translateY(0) rotate(${rot}deg)`, opacity:1 },
    { transform: `translate(${dx}px, ${dy}px) rotate(${rotEnd}deg)`, opacity:0.06 }
  ], { duration: dur + Math.random()*600, easing:'cubic-bezier(.2,.8,.2,1)' });
  setTimeout(()=> { try{ c.remove(); } catch(e){} }, dur + 900);
}
function spawnConfettiBurst(count=20){
  for(let i=0;i<count;i++){
    const x = window.innerWidth/2 + (Math.random()*240 - 120);
    const y = window.innerHeight/3 + (Math.random()*60 - 30);
    const color = ['#ff6b81','#ffcdde','#ffd1e0','#ffc0cb','#ff9aa8'][Math.floor(Math.random()*5)];
    spawnConfettiPiece(x,y,color, Math.random()*360, 1200 + Math.random()*900);
  }
}

/* ============================
   SOUND: tiny beeps (kept)
   ============================ */
let tinyAudioCtx = null;
function playBeep(freq=520, ms=120){
  try{
    if(!tinyAudioCtx) tinyAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const o = tinyAudioCtx.createOscillator();
    const g = tinyAudioCtx.createGain();
    o.connect(g); g.connect(tinyAudioCtx.destination);
    o.type = 'sine';
    o.frequency.value = freq;
    g.gain.value = 0.04;
    o.start();
    setTimeout(()=> { try{ o.stop(); } catch(e){} }, ms);
  }catch(e){}
}

/* ============================
   NO BUTTON (penolakan) logic
   (kept from original; unchanged)
   ============================ */
const noBtn = qs('#noBtn');
const cloneArea = qs('#cloneArea');

let noState = {
  spawned: 0,
  lastMove: 0,
  glitchTimer: null,
  listenersAttached: false,
  proximityAttached: false
};

function randomSign(){ return Math.random()>0.5?1:-1; }
function randRange(min,max){ return min + Math.random()*(max-min); }

function brutalEscape(){
  const overshoot = Math.max(window.innerWidth, window.innerHeight) * 2.6;
  const x = (randomSign() * (overshoot + Math.random()*2000));
  const y = (randomSign() * (overshoot + Math.random()*2000));
  noBtn.style.position = 'fixed';
  noBtn.style.left = x + 'px';
  noBtn.style.top = y + 'px';
  noState.lastMove = now();
  spawnNoClones(5 + Math.floor(Math.random()*6));
  if(Math.random() < 0.6) playBeep(300 + Math.random()*400, 160);
}

function spawnNoClones(count=4){
  for(let i=0;i<count;i++){
    const c = document.createElement('button');
    c.className = 'btn btn-no no-clone';
    c.textContent = 'Aku udah ga sayang kamu üíî';
    c.style.left = (randRange(80, window.innerWidth-280)) + 'px';
    c.style.top = (randRange(120, window.innerHeight-220)) + 'px';
    c.style.transform = `translate(-6px,-4px) rotate(${randRange(-20,20)}deg)`;
    c.style.pointerEvents = 'auto';
    c.style.zIndex = 999999;
    cloneArea.appendChild(c);

    setTimeout(()=> {
      c.animate([
        { transform: c.style.transform, opacity:1 },
        { transform: `translate(${randRange(-400,400)}px, ${randRange(-400,400)}px) rotate(${randRange(-360,360)}deg)`, opacity:0 }
      ], { duration: 900 + Math.random()*800, easing:'cubic-bezier(.2,.8,.2,1)' });
    }, 80 + Math.random()*180);

    setTimeout(()=> { try{ c.remove(); } catch(e){} }, 1200 + Math.random()*1800);

    c.addEventListener('click', (ev)=> {
      ev.stopPropagation();
      c.animate([{ transform:'scale(1.05)' }, { transform:'scale(1)' }], { duration:140 });
      playBeep(640 + Math.random()*200,120);
      const tip = document.createElement('div');
      tip.className = 'tooltip';
      tip.textContent = "Cuma clone! üòè";
      tip.style.left = (parseFloat(c.style.left) + 12) + 'px';
      tip.style.top = (parseFloat(c.style.top) - 36) + 'px';
      document.body.appendChild(tip);
      setTimeout(()=> tip.remove(), 900);
    });
  }
}

function maybeEscapeOnProximity(e){
  try{
    const rect = noBtn.getBoundingClientRect();
    const dx = e.clientX - (rect.left + rect.width/2);
    const dy = e.clientY - (rect.top + rect.height/2);
    const dist = Math.sqrt(dx*dx + dy*dy);
    const threshold = 160 + Math.min(600, noState.spawned * 40);
    if(dist < threshold){
      noState.spawned += 1;
      brutalEscape();
    }
  }catch(e){}
}

function occasionalGlitch(){
  if(noState.glitchTimer) clearTimeout(noState.glitchTimer);
  if(Math.random() < 0.56){
    noBtn.style.opacity = '0.02';
    noBtn.style.transform = 'scale(.3) rotate(45deg)';
    noBtn.style.pointerEvents = 'none';
    setTimeout(()=> {
      noBtn.style.opacity = '1';
      noBtn.style.transform = '';
      noBtn.style.pointerEvents = 'auto';
    }, 700 + Math.random()*1200);
  }
  noState.glitchTimer = setTimeout(occasionalGlitch, 2200 + Math.random()*3400);
}

/* Attach NO button listeners (only when main opened) */
function attachNoButtonBehavior(){
  if(noState.listenersAttached) return;
  // hover
  noBtn.addEventListener('mouseenter', (e)=> {
    if(Math.abs(parseFloat(noBtn.style.left || 0)) > 2000 || Math.abs(parseFloat(noBtn.style.top || 0)) > 2000){
      spawnNoClones(3 + Math.floor(Math.random()*4));
      playBeep(440,120);
      return;
    }
    brutalEscape();
  });
  // click
  noBtn.addEventListener('click', (ev)=> { ev.stopPropagation(); openSadModal(); });
  // proximity via mousemove
  document.addEventListener('mousemove', maybeEscapeOnProximity);
  // start glitching
  occasionalGlitch();
  noState.listenersAttached = true;
}

/* safe repositioner */
function normalizeNoButtonPos(){
  setTimeout(()=> {
    try{
      const rect = noBtn.getBoundingClientRect();
      if(rect.right < 0 || rect.left > window.innerWidth || rect.top > window.innerHeight || rect.bottom < 0){
        noBtn.style.position = 'static';
        noBtn.style.left = '';
        noBtn.style.top = '';
        noBtn.style.transform = '';
      }
    }catch(e){}
  }, 12000);
}
window.addEventListener('resize', normalizeNoButtonPos);

/* ============================
   MODAL helpers
   ============================ */
function openLoveModal(){ qs('#loveModal').classList.add('show'); playBeep(); announceSR("Modal cinta dibuka"); }
function closeModal(id){ qs('#'+id).classList.remove('show'); announceSR("Modal tertutup"); }
function openSadModal(){ qs('#sadModal').classList.add('show'); playBeep(380); announceSR("Modal penolakan dibuka"); }

/* ============================
   WhatsApp integration (send button)
   ============================ */
const waNumberInternational = '6285694096352'; // <-- ubah kalau perlu
const waVariants = [
  "Hai.. aku kangen. Maafin aku ya, boleh coba balikan nggak? Kalau iya, balas 'iya' aja üòÖ‚ù§Ô∏è",
  "Halo, aku pengen minta kesempatan lagi. Janji bakal lebih perhatian dan ingat hal-hal kecil. Boleh kita coba lagi? üôèüíï",
  "Eh.. aku kepikiran kamu terus. Boleh gak kita balikan? Aku janji bakal berubah jadi lebih baik. üò¨üíñ",
  "Kalau kamu bosen, bilang aja. Kalau gak, bilang 'boleh' ‚Äî biar aku hepi. üòÖüíó"
];
function waUrlFor(message){
  const encoded = encodeURIComponent(message);
  return `https://wa.me/${waNumberInternational}?text=${encoded}`;
}

const yesBtn = qs('#yesBtn');
const waSendBtn = qs('#waSendBtn');

yesBtn.addEventListener('click', (ev)=> {
  pulseElement(yesBtn);
  setTimeout(()=> spawnConfettiBurst(10), 220);
  openLoveModal();
});

// long-press on yesBtn to directly send WA (mobile convenience)
let pressTimer = null;
yesBtn.addEventListener('touchstart', (e)=> {
  if(pressTimer) clearTimeout(pressTimer);
  pressTimer = setTimeout(()=> {
    directSendWhatsApp(waVariants[0]);
  }, 750);
}, { passive:true });
yesBtn.addEventListener('touchend', (e)=> { if(pressTimer) clearTimeout(pressTimer); }, { passive:true });

waSendBtn.addEventListener('click', ()=>{
  waSendBtn.disabled = true;
  waSendBtn.textContent = 'Membuka WhatsApp‚Ä¶';
  playBeep(720);
  for(let i=0;i<6;i++) setTimeout(()=> spawnHeart(Math.random()*window.innerWidth, -20), i*60);
  spawnConfettiBurst(18);
  setTimeout(()=> {
    window.open(waUrlFor(waVariants[0]), '_blank');
    waSendBtn.disabled = false;
    waSendBtn.textContent = 'Kirim via WhatsApp üíå';
    setTimeout(()=> closeModal('loveModal'), 900);
  }, 700);
});

function directSendWhatsApp(message){
  const url = waUrlFor(message);
  window.open(url, '_blank');
}

/* small pulse animation helper */
function pulseElement(el){
  try{
    el.animate([
      { transform:'scale(1)', boxShadow: '0 8px 28px rgba(255,90,120,0.15)' },
      { transform:'scale(1.06)', boxShadow: '0 18px 38px rgba(255,90,140,0.22)' },
      { transform:'scale(1)', boxShadow: '0 8px 28px rgba(255,90,120,0.15)' }
    ], { duration:420, easing:'cubic-bezier(.2,.8,.2,1)' });
  }catch(e){}
}

/* ============================
   COPY & PREVIEW UI (extra UX)
   ============================ */
(function injectCopyUI(){
  const container = qs('.container');
  if(!container) return;
  const box = document.createElement('div');
  box.style.marginTop = '12px';
  box.style.display = 'flex';
  box.style.justifyContent = 'center';
  box.style.gap = '8px';
  box.innerHTML = `
    <button class="btn" id="copyMsgBtn" style="background:linear-gradient(135deg,#fff,#ffeef3); color:#d63b5a; font-weight:600; border:1px solid rgba(255,255,255,0.06)">Salin pesan lucu</button>
    <button class="btn" id="previewMsgBtn" style="background:rgba(255,255,255,0.06)">Lihat varian pesan</button>
  `;
  container.appendChild(box);
  const copyBtn = qs('#copyMsgBtn');
  const prevBtn = qs('#previewMsgBtn');

  copyBtn.addEventListener('click', ()=>{
    navigator.clipboard?.writeText(waVariants[0]).then(()=>{
      copyBtn.textContent = 'Tersalin! ‚úî';
      playBeep(720);
      setTimeout(()=> copyBtn.textContent = 'Salin pesan lucu', 1200);
    }).catch(()=>{
      window.prompt('Salin pesan ini:', waVariants[0]);
    });
  });

  prevBtn.addEventListener('click', ()=>{
    qs('#loveModalParagraph').textContent = waVariants[1];
    openLoveModal();
  });
})();

/* ============================
   KEYBOARD EASTER EGGS
   - keep existing keys; added 'y' = toggle rain (safe)
   ============================ */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'h'){
    for(let i=0;i<14;i++) setTimeout(()=> spawnHeart(Math.random()*window.innerWidth, -30), i*80);
  } else if(e.key === 'c'){
    spawnNoClones(8);
  } else if(e.key === 'r'){
    noBtn.style.position='static'; noBtn.style.left=''; noBtn.style.top=''; noBtn.style.transform='';
    playBeep(720);
  } else if(e.key === 'w'){
    directSendWhatsApp(waVariants[0]);
  } else if(e.key === 'y'){
    // keyboard shortcut to toggle rain
    qs('#rainToggle').click();
  }
});

/* ============================
   INIT AFTER OPEN (critical)
   - attach noBtn behavior only here
   - start slides, spawn ambient hearts
   - startAmbientSprinkle kept unchanged
   ============================ */
function initAfterOpen(){
  noBtn.style.position = 'static';
  noBtn.style.left = '';
  noBtn.style.top = '';
  startSlideshow();
  attachNoButtonBehavior();
  for(let i=0;i<10;i++) setTimeout(()=> spawnHeart(), i*120);
  playBeep(580);
  try{
    envelope.animate([
      { transform:'translateY(0) scale(1)' },
      { transform:'translateY(-6px) scale(1.02)' },
      { transform:'translateY(0) scale(1)' }
    ], { duration:2600, iterations:Infinity, easing:'ease-in-out' });
  }catch(e){}
}

/* ============================
   Ambient sprinkle utilities (kept)
   ============================ */
function spawnTinySpark(x,y, dur=900){
  const s = document.createElement('div');
  s.style.position='fixed'; s.style.left=x+'px'; s.style.top=y+'px'; s.style.width='6px'; s.style.height='6px';
  s.style.borderRadius='50%'; s.style.zIndex=99998; s.style.background='rgba(255,255,255,0.85)';
  s.style.opacity=0.9; document.body.appendChild(s);
  const dx = (Math.random()*120 - 60), dy = (Math.random()*80 + 40);
  s.animate([{ transform:'translate(0,0)', opacity:1 }, { transform:`translate(${dx}px, ${dy}px)`, opacity:0 }], { duration: dur, easing:'cubic-bezier(.2,.8,.2,1)' });
  setTimeout(()=> { try{ s.remove() } catch(e){} }, dur+80);
}
let ambientTimer = null;
function startAmbientSprinkle(){
  if(ambientTimer) return;
  ambientTimer = setInterval(()=> {
    if(Math.random() < 0.35) spawnTinySpark(Math.random()*window.innerWidth, Math.random()*window.innerHeight*0.6, 900+Math.random()*600);
  }, 900);
}
function stopAmbientSprinkle(){
  if(ambientTimer){ clearInterval(ambientTimer); ambientTimer = null; }
}
if(document.readyState === 'loading'){
  document.addEventListener('DOMContentLoaded', ()=> startAmbientSprinkle() );
}else startAmbientSprinkle();

/* ============================
   Accessibility / small fallback
   ============================ */
envelope.setAttribute('tabindex', '0');
envelope.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') openLetter(); });

yesBtn.setAttribute('aria-pressed','false');
yesBtn.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') yesBtn.click(); });

noBtn.setAttribute('aria-pressed','false');
noBtn.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') noBtn.click(); });

/* ============================
   Final note: everything defined
   ============================ */
</script>
</body>
</html>
